# Web Request Capture Pro v2.3

## 🎯 主要功能

### 已完成功能
- ✅ **资源识别与黑名单模式**：默认支持所有资源类型下载，仅排除API、Ajax、WebSocket、CDN、统计、广告等不必要的资源类型
- ✅ **按域名+路径自动建目录**：导出时自动按照域名和实际路径创建目录结构，保持网站原有的文件组织结构
- ✅ **直接弹出文件夹选择器**：无需多余确认提示，点击导出后直接弹出文件夹选择器
- ✅ **批量导出资源**：支持一键导出所有筛选后的资源，直接保存到Downloads文件夹，使用统一的文件夹结构
- ✅ **单个资源保存**：每个资源都有独立的"Save"按钮，点击后弹出文件夹选择器
- ✅ **实时下载状态**：表格显示每个资源的下载状态（Ready/Downloading/Downloaded/Failed/Excluded）
- ✅ **内存直接写入**：单个保存功能已实现从内存直接写入文件，无需重新下载
- ✅ **资源选择功能**：支持单选/全选资源，可排除特定资源不参与导出操作

### 🔥 最新更新（v2.3）
- **🆕 资源选择功能**：在数据列表中添加选择标记，支持全选/取消全选操作
- **🎯 精确导出控制**：Export JSON和Export Resources仅导出选中的资源
- **🎨 视觉状态反馈**：被排除的资源以不同颜色显示，一目了然
- **🔄 智能状态管理**：全选复选框支持中间状态，准确反映当前选择情况
- **📊 实时计数更新**：按钮显示选中资源数量，导出提示包含准确的选中数量
- **批量导出优化**：修复了批量导出时每个文件创建单独文件夹的问题，现在所有文件都保存在同一个时间戳文件夹内
- **统一文件夹结构**：批量导出和单个保存使用相同的目录结构（域名/路径），确保文件组织一致性
- **智能保存机制**：优先尝试保存到用户选择的目录，遇到CORS限制时自动降级到Downloads文件夹
- **实时状态更新**：保存过程中实时更新资源状态（Downloading → Downloaded/Failed）
- **CORS自动处理**：智能检测并处理跨域限制，确保文件能够成功保存
- **状态可视化**：不同状态使用不同颜色和动画效果区分

## 🚀 使用方法

### 1. 开始捕获
1. 在URL输入框中输入要分析的网站地址
2. 点击"Start Capture"开始捕获网络请求
3. 在新打开的浏览器窗口中浏览网站
4. 返回插件界面查看捕获的资源

### 2. 资源选择与单个保存
1. 在资源列表中，每个资源都有一个复选框，默认全部选中
2. 可以单击复选框取消选择不需要的资源
3. 点击表头的复选框可以全选/取消全选所有资源
4. 被排除的资源会以淡色背景显示
5. 点击单个资源的"Save"按钮，在弹出的文件夹选择器中选择保存位置
6. 系统会尝试保存到选择的目录，如遇到浏览器安全限制，会自动保存到Downloads文件夹并保持相同的目录结构
7. 查看状态列的实时更新（Downloading → Downloaded）

**注意**：由于浏览器安全策略，某些资源可能因CORS限制无法直接保存到用户选择的目录，系统会自动降级到Downloads文件夹，但保持相同的文件组织结构。

### 3. 批量导出选中资源
1. 使用筛选器选择需要的资源类型
2. 使用复选框选择/排除特定资源
3. 点击"Export Resources (X)"按钮，X显示当前选中的资源数量
4. 选择保存文件夹
5. 系统按域名和路径自动组织文件结构，仅导出选中的资源

### 4. 导出URL列表
1. 选择需要导出URL的资源（使用复选框）
2. 点击"Export Data"按钮
3. 系统将选中的可下载资源URL导出为JSON数组格式

## 📋 资源类型支持

### 支持的资源类型
- 🖼️ **图片文件**：JPG、PNG、GIF、WebP、SVG、BMP、ICO等
- 🎵 **音频文件**：MP3、WAV、OGG、AAC、FLAC等
- 🎬 **视频文件**：MP4、AVI、MOV、WebM、MKV等
- 📄 **文档文件**：PDF、DOC、XLS、PPT等
- 💻 **代码文件**：CSS、JS、JSON、XML、HTML等
- 🔠 **字体文件**：TTF、WOFF、WOFF2、EOT等
- 🎮 **游戏资源**：模型、纹理、音效等
- 📦 **压缩文件**：ZIP、RAR、7Z等

### 排除的资源类型（黑名单）
- ❌ **API接口**：/api/、/ajax/、/graphql等
- ❌ **统计追踪**：Google Analytics、广告追踪等
- ❌ **实时通信**：WebSocket、Socket.IO等
- ❌ **CDN服务**：Cloudflare CDN、RUM等
- ❌ **动态脚本**：带参数的PHP、ASP、JSP等

## 🛠️ 技术实现

### 混合保存机制
1. **智能尝试**：优先尝试直接保存到用户选择的目录
2. **自动降级**：遇到CORS限制时自动降级到Downloads文件夹
3. **保持结构**：无论哪种方式都保持域名+路径的目录结构
4. **用户友好**：清晰提示实际保存位置和处理过程

### 浏览器限制说明
- **CORS限制**：某些资源受同源策略保护，无法直接获取
- **安全策略**：部分网站返回403禁止访问错误
- **自动处理**：系统自动检测并选择最佳保存方式
- **成功保证**：通过降级机制确保文件总能成功保存

### 文件组织结构
```
选择的文件夹/
├── 域名1/
│   ├── 路径1/
│   │   ├── 文件1
│   │   └── 文件2
│   └── 路径2/
│       └── 文件3
├── 域名2/
│   └── 文件4
└── index.txt (资源索引文件)
```

## 📊 状态说明

| 状态 | 含义 | 颜色 |
|------|------|------|
| Ready | 可下载，等待用户操作 | 灰色 |
| Downloading | 正在下载中 | 蓝色（动画） |
| Downloaded | 下载完成 | 绿色 |
| Failed | 下载失败 | 红色 |
| N/A | 不支持下载的资源类型 | 灰色 |

## 🔧 开发者信息

- **版本**：v2.3
- **兼容性**：Chrome 90+
- **权限**：webRequest、downloads、storage、host_permissions
- **API使用**：File System Access API、Chrome Extensions API

## 📝 更新日志

### v2.3 (2024-06-25)
- 🆕 添加资源选择功能（复选框）
- 🎯 Export JSON和Export Resources仅导出选中资源
- 🎨 被排除资源的视觉反馈（淡色背景）
- 🔄 全选复选框支持中间状态显示
- 📊 按钮实时显示选中资源数量

### v2.2 (2024-06-24)
- 🎉 实现Export JSON功能，导出可下载资源URL数组
- 🔄 优化批量导出和单个保存的统一性
- 🎨 改进用户体验和状态显示
- 🐛 修复路径处理和文件组织结构

### v2.1 (2024-06-23)
- 🎉 实现内存直接写入功能
- 🔄 优化下载状态实时更新
- 🎨 改进用户界面和状态显示
- 🐛 修复文件名生成和状态更新问题

### v2.0
- 🏗️ 重构资源识别逻辑（黑名单模式）
- 📁 实现按域名+路径自动建目录
- 🎯 优化用户体验，去除多余确认提示
- 📊 添加实时下载状态显示
- 
### v1.0
- 初始版本
- 实现基本的资源捕获和导出功能

## 🤝 贡献

欢迎提交issue和pull request来改进这个项目!
